<div class="script-paragraph relative">
	<div class="paragraph-layout flex align-items-start">
		<div class="paragraph-content flex flex-column gap-4">
			<div class="slides-column">
				@if (getSelectedSlides(); as selectedSlides) {
					@if (selectedSlides.length) {
						<div class="selected-slides-grid">
							@for (selectedSlide of selectedSlides; track selectedSlide.slide_file; let selectedIndex = $index) {
								<div class="slide-wrapper border-1 surface-border border-round-md overflow-hidden selected-slide-display">
									<div class="selected-slide-image">
										<img [src]="selectedSlide.slide_file" class="slide" />
										<div class="overlay">
											<div class="score-bar" [style.width.%]="selectedSlide.score * 100"></div>
										</div>
										<button
											data-testid="remove-selected-slide-button"
											pButton
											type="button"
											icon="pi pi-times"
											class="selected-slide-remove p-button-rounded p-button-text"
											(click)="removeSelectedSlide(selectedSlide)"
											[attr.aria-label]="'Remove selected slide ' + (selectedIndex + 1)"
										></button>
									</div>
									<div class="selected-slide-caption text-sm text-700 p-2 text-center">
										Slide {{ selectedIndex + 1 }}
									</div>
								</div>
							}
						</div>
					}
				}

				@if (paragraph.slideCandidates.length > 0) {
					<div class="suggestions-section">
						<div class="suggestions-header">
							<h4 class="suggestions-title">Suggestions</h4>
							<button
								id="cancel-suggestions-button-{{ paragraph.id }}"
								data-testid="cancel-suggestions-button"
								pButton
								type="button"
								icon="pi pi-times"
								label="Cancel"
								class="suggestions-cancel-button p-button-text p-button-sm"
								(click)="cancelSuggestions()"
							></button>
						</div>
						<p-carousel
							class="slide-carousel"
							[value]="paragraph.slideCandidates"
							[numVisible]="3"
							[numScroll]="1"
							[responsiveOptions]="responsiveOptions"
							[showIndicators]="false"
							[showNavigators]="paragraph.slideCandidates.length > 3"
							[circular]="paragraph.slideCandidates.length > 3"
						>
							<ng-template pTemplate="item" let-slideCandidate>
								<div class="slide-wrapper border-1 surface-border border-round-md overflow-hidden with-action-bar">
									<img [src]="slideCandidate.slide_file" class="slide" />
									<div class="overlay">
										<div class="score-bar" [style.width.%]="slideCandidate.score * 100"></div>
									</div>
									<div class="slide-action-bar">
										<button
											data-testid="approve-slide-button"
											pButton
											type="button"
											icon="pi pi-check"
											label="Approve"
											class="slide-action-button approve-button"
											(click)="selectSlideCandidate(slideCandidate)"
										></button>
										<button
											data-testid="reject-slide-button"
											pButton
											type="button"
											icon="pi pi-times"
											label="Reject"
											class="slide-action-button reject-button"
											(click)="rejectSlideCandidate(slideCandidate)"
										></button>
									</div>
								</div>
							</ng-template>
						</p-carousel>
					</div>
				}

				<div class="paragraph-divider">
					<button
						id="add-slide-button-{{ paragraph.id }}"
						data-testid="add-slide-button"
						pButton
						type="button"
						icon="pi pi-plus"
						class="divider-button p-button-rounded p-button-success"
						[disabled]="!(selectedLibrarySlide$ | async)"
						(click)="addSlideFromLibrary()"
					></button>
					<div class="divider-line"></div>
				</div>
			</div>

			<div class="paragraph-text border-round surface-section shadow-1" [class.editing]="isEditing">
				@if (isParagraphCompleted()) {
					<i class="pi pi-check-circle paragraph-status-icon" data-testid="paragraph-completed-icon"></i>
				}
				@if (isEditing) {
					<div class="paragraph-edit-container" data-testid="paragraph-edit-container">
						<textarea
							id="paragraph-textarea-{{ paragraph.id }}"
							data-testid="paragraph-textarea"
							class="paragraph-edit-textarea"
							rows="6"
							[(ngModel)]="textDraft"
							(keydown)="onKeydown($event)"
						></textarea>
						<div class="paragraph-edit-actions">
							<button
								id="paragraph-save-button-{{ paragraph.id }}"
								data-testid="paragraph-save-button"
								pButton
								type="button"
								label="Save"
								icon="pi pi-check"
								class="p-button-sm paragraph-edit-save"
								[disabled]="isSaveDisabled()"
								(click)="saveParagraph($event)"
							></button>
							<button
								id="paragraph-cancel-button-{{ paragraph.id }}"
								data-testid="paragraph-cancel-button"
								pButton
								type="button"
								label="Cancel"
								icon="pi pi-times"
								class="p-button-sm p-button-text paragraph-edit-cancel"
								(click)="cancelEdit($event)"
							></button>
						</div>
					</div>
				} @else {
					<div
						id="paragraph-text-{{ paragraph.id }}"
						data-testid="paragraph-text"
						class="paragraph-text-body paragraph-readonly"
						tabindex="0"
						(click)="enterEdit($event)"
					>
						{{ paragraph.text }}
					</div>
				}
			</div>
		</div>
	</div>
</div>
